(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{301:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_1-快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-快速入门"}},[t._v("#")]),t._v(" 1 快速入门")]),t._v(" "),s("h2",{attrs:{id:"_1-1-基础知识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-基础知识"}},[t._v("#")]),t._v(" 1.1 基础知识")]),t._v(" "),s("h3",{attrs:{id:"_1-1-1-存储基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-存储基础"}},[t._v("#")]),t._v(" 1.1.1 存储基础")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 基础知识、文件系统、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("基础知识")])]),t._v(" "),s("p",[t._v("存储基础")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t我们知道，对于一个计算机设备来说，其存储功能是非常重要的，也就是说，任何一台电脑上，必须包含一个设备"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("磁盘。这个磁盘就是用于数据存储的目的的。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("常见的存储设备接口：\nDAS设备：IDE、SATA、SCSI、SAS、USB\n\t无论是那种接口，他都是存储设备驱动下的磁盘设备，而磁盘设备其实就是一种存储，这种存储是直接接入到主板总线上去的。\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 基于数据块来进行访问\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 基于服务器方式实现互联访问，操作简单、成本低。\nNAS设备：NFS、CIFS\n\t几乎所有的网络存储设备基本上都是以文件系统样式进行使用，无法进一步格式化操作。\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 基于文件系统方式访问\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 没有网络区域限制，支持多种协议操作文件。\nSAN:scsi协议、"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FC")]),t._v(" SAN、iSCSI\n\t基于SAN方式提供给客户端操作系统的是一种块设备接口，所以这些设备间主要是通过scsi协议来完成正常的通信。\n\tscsi的结构类似于TCP/IP协议，也有很多层，但是scsi协议主要是用来进行存储数据操作的。既然是分层方式实现的，那就是说，有部分层可以被替代。比如将物理层基于"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FC")]),t._v("方式来实现，就形成了FCSAN，如果基于以太网方式来传递数据，就形成了iSCSI模式。\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 基于数据块来实现访问\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 不受服务器约束，通过存储池实现资源的高效利用，扩展性好\n")])])]),s("p",[s("img",{attrs:{src:"image/image-20220923150326956.png",alt:"image-20220923150326956"}})]),t._v(" "),s("p",[t._v("存储使用")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t对于存储的使用，我们需要借助于文件系统的方式来实现，而存储在使用前往往需要进行格式化。\n")])])]),s("p",[s("strong",[t._v("文件系统")])]),t._v(" "),s("p",[t._v("简介")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t文件系统的基本数据单位是文件，它的目的是对磁盘上的文件进行组织管理，那组织的方式不同，就会形成不同的文件系统。\tLinux 文件系统会为每个文件分配两个数据结构：索引节点"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("和目录项"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("directory entry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，它们主要用来记录文件的元信息和目录层次结构。\n\n索引节点 \n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 用来记录文件的元信息，比如 inode 编号、文件大小、访问权限、创建时间、等信息。\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 索引节点是文件的唯一标识，它们之间一一对应，也同样都会被存储在硬盘中，所以索引节点同样占用磁盘空间。\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 用户查找的时候，会根据inode的信息，找到对应的数据块，我们可以将inode理解为数据块的路由信息。\n目录项\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 用来记录文件的名字、索引节点指针以及与其他目录项的层级关联关系。多个目录项关联起来，形成目录结构\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 它与索引节点不同，目录项是由内核维护的一个数据结构，不存放于磁盘，而是缓存在内存。\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 目录项和索引节点的关系是多对一\n")])])]),s("p",[t._v("数据存储")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("数据块\n\t磁盘读写的最小单位是扇区，扇区的大小只有 512B 大小，文件系统把多个扇区组成了一个逻辑块，每次读写的最小单位就是逻辑块（数据块），Linux 中的逻辑块大小为 4KB，也就是一次性读写 8 个扇区，这将大大提高了磁盘的读写的效率。\n\t磁盘想要被文件系统使用，需要进行格式化，此时磁盘会被分成三个存储区域\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 超级块，用来存储文件系统的详细信息，比如块个数、块大小、空闲块等等。 \n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 索引节点区，用来存储索引节点；\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 数据块区，用来存储文件或目录数据；\n")])])]),s("p",[t._v("存储应用的基本方式")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636079494896.png",alt:"1636079494896"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("为了加速文件的访问，通常会把相关信息加载到内存中，但是考虑到内存的容量限制，它们加载进内存的时机是不同的：\n\t超级块：当文件系统挂载时进入内存；\n\t索引节点区：当文件被访问时进入内存；\n\t数据块：文件数据使用的时候进入内；\n")])])]),s("p",[t._v("文件存储")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t文件的数据是要存储在硬盘上面的，数据在磁盘上的存放方式，有两种方式：\n\t\t连续空间存放方式 \n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 同一个文件存放到一个连续的存储空间\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 一旦文件删除可能导致磁盘空间碎片\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 文件内容长度扩展不方便，综合效率是非常低的。\n\t\t非连续空间存放方式\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 同一个文件存放到一个不连续的存储空间，每个空间会关联下一个空间\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 可以消除磁盘碎片，可大大提高磁盘空间的利用率，同时文件的长度可以动态扩展。\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 查找效率低，需要额外的资源消耗。\n")])])]),s("p",[s("img",{attrs:{src:"image/image-20220923154844319.png",alt:"image-20220923154844319"}})]),t._v(" "),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-1-2-dfs概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-dfs概述"}},[t._v("#")]),t._v(" 1.1.2 DFS概述")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 DFS简介、原理解读、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("DFS简介")])]),t._v(" "),s("p",[t._v("存储基础")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("存储处理能力不足：\n\t传统的IDE的io值是100次"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("秒，SATA固态磁盘500次"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("秒，NVMe固态硬盘达到2000-4000次"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("秒。即时磁盘的io能力再大数十倍，难道能够抗住网站访问高峰期数十万、数百万甚至上亿用户的同时访问么？这还受到网络io能力的限制。\n\n存储空间能力不足：\n\t单块磁盘的容量再大，也无法满足用户的正常访问所需的数据容量限制。\n\n需求：\n\t可以实现横向扩展的存储系统，这种存储系统在市面中的表现样式很多，不过他们有一个统一的称呼 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 分布式存储系统。\n")])])]),s("p",[t._v("分布式文件系统")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t随着传输技术发展，操作系统读写数据的方式，不再局限于本地I/O技术，开始支持远距离的TCP/IP方式获取数据。它相当于新增一种可以远距离传输的I/O技术，使得分散的存储设备和用户操作系统可以通过网络方式接入联合在一起，形成更大容量，更易于拓展伸缩的存储系统，对此人们引入分布式文件系统的概念。 \n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t分布式文件系统（Distributed File System，DFS）是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连；或是若干不同的逻辑磁盘分区或卷标组合在一起而形成的完整的有层次的文件系统。\n\t分布式文件系统的发展现后经历了三个阶段：网络文件系统、共享SAN文件系统、面向对象的并行文件系统。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t从本质上来说，分布式文件系统跟传统的文件系统没本质的差别，只不过是需要额外考虑多节点网络连接的可靠性、接入的存储设备的复杂性，需要文件系统、网络环境、存储策略共同协作而已。\n\t由于文件系统与传统一致，网络环境不受控制，所以，我们平常所说的分布式文件系统，也等同于分布式存储系统。\n")])])]),s("p",[t._v("DSS简介")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t分布式存储系统，是将数据分散存储在多台独立的设备上，从而解决传统的存储系统的容量和性能限制。所以如果存储服务器的可靠性和安全性无法满足大规模存储应用的需要，那么它就会成为分布式文件系统的性能瓶颈。\n\t其实，分布式存储系统可以理解为多台单机存储系统的各司其职、协同合作，统一的对外提供存储的服务。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t分布式网络存储系统采用可扩展的系统结构，利用多台存储服务器分担存储负荷，利用位置服务器定位存储信息，它不但提高了系统的可靠性、可用性和存取效率，还易于扩展。\n\t按照分布式存储系统的作用场景，我们可以将其划分为 存储非结构化数据的分布式文件系统、存储结构化数据的分布式数据库、存储半结构化数据的分布式NoSQL数据库等。\n")])])]),s("p",[t._v("常见的文件系统")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/image-20220923162020799.png",alt:"image-20220923162020799"}})]),t._v(" "),s("p",[s("strong",[t._v("原理解读")])]),t._v(" "),s("p",[t._v("分布式数据存储")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636082742521.png",alt:"1636082742521"}})]),t._v(" "),s("p",[t._v("存储角色")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("节点角色\n\t当我们将数据存储到分布式系统上的时候，就需要有一个路由机制，能够将我们的请求转交给对应的存储节点上。所以，根据我们对数据在单节点上的存储原理，我们就需要有一个单独的节点来存储所有数据的元数据信息，然后，分布式存储就作为block的存储区域，专门用户数据存储。\n\t存储元素据的节点我们把它称为NameNode，存储具体数据的节点我们称为DataNode。\n\t\n数据拆分：\n\t当我们要存储的数据非常大，比如说5个G，所以我们在存储的时候，将存储的数据信息发送给元数据控制节点，然后元数据控制节点根据自定义的存储策略，将要存储的数据进行拆分"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("64M一块"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("也就是数据切片，将切分后的数据作为一个独立的文件，然后基于同样的路由逻辑，将其分散存储到不同的存储节点上。\n\t元数据控制节点，在进行数据切分的时候，还需要能够组合起来，所以拆分后的数据块大小、组合时候的偏移信息、路由到的节点等信息都应该有针对性的记录。\n\t在切片的时候，还可以实现并行的存储逻辑效果。每一个数据块都称为一个shard。\n")])])]),s("p",[t._v("数据高可用")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("元数据高可用\n\t由于NameNode保存了非常重要的数据信息，所以为了避免因为NameNode故障导致的问题，我们一定要对NameNode进行高可用处理。\n\t由于元数据非常小"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("几k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，所以NameNode上的数据是 非常密集而且io量非常小的。所以为了提高数据的查询和存储效率，我们一般将这些数据保存到内存中。所以为了防止主机断电导致数据丢失，所以我们需要随时的进行数据同步到磁盘中，因为没有办法判断每一次到底是哪种数据被访问或更改，所以在磁盘数据同步的时候，随机io是非常大的。\n\t同时，为了避免单节点的数据文件丢失，我们需要通过共享存储的方式将数据保存在第三方的存储设备上，同时还需要对数据存储主机进行高可用\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("数据高可用\n\t由于我们对元数据进行了数据切片的方式，实现了数据的高效率存取，但是我们知道，一旦这些数据块中，任意丢弃一块，就会导致所有的数据无法正常的使用。所以有必要对这些数据进行高可用的操作。对于高可用的方式，我们一般会有两种方式来实现数据的冗余。\n\t节点级：\n\t\t通过对主机节点进行高可用，从而实现数据的冗余，这种机制，成本太高了，不值得。\n\t数据级：\n\t\t我们对拆分后的数据块进行副本操作，而且还可以根据节点的数量，自定义冗余的副本数量。这是推荐的。\n\t\t主角色的数据块称为 primary shard，副本数据块称为 replica shard。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t在进行数据块数据冗余的时候，这些副本的策略机制是有元数据节点来进行控制的，当一个DataNode故障的时候：\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 如果主shard没有了，从所有的副本shard中选择一个主。\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 如果副本shard没有了，再创建一个副本shard即可。\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 一旦DataNode节点数量多于副本数量，控制副本数据在另一个DataNode节点上复制一个新的副本\n\t\t\t从而保证副本的总体是满足预期的。\n\t\n\t为了防止数据副本节点在同一个物理机架上的时候，因为机架故障，导致所有副本无效，所以我们在考虑冗余的时候，还需要考虑地理位置区域的冗余。\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-1-3-存储简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-存储简介"}},[t._v("#")]),t._v(" 1.1.3 存储简介")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 存储类型、ceph简介、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("存储类型")])]),t._v(" "),s("p",[t._v("三种存储")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636084901961.png",alt:"1636084901961"}})]),t._v(" "),s("p",[t._v("块存储")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t块存储是将裸磁盘空间整个映射给主机使用的，主机层面操作系统识别出硬盘，与我们服务器内置的硬盘没有什么差异"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("可以自由的进行磁盘进行分区、格式化，\n\t块存储不仅仅是直接使用物理设备，间接使用物理设备的也叫块设备，比如虚机创建虚拟磁盘、虚机磁盘格式包括raw、qcow2等。\t\n\t常见解决方案：\n\t\tABS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Azure Block Storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、GBS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Google Block Storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、EBS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elastic Block Storag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tCinder、Ceph RBD、sheepdog\n")])])]),s("p",[t._v("文件系统存储")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t最常见、最容易、最经典实现的一种存储接口。它可以直接以文件系统挂载的方式，为主机提供存储空间资源。它有别于块存储的特点就在于，可以实现共享效果，但是有可能受网络因素限制导致速度较慢。\n\t\n\t常见解决方案：\n\t\tAFS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Azure FileStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、GFS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Google FileStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、EFS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elastic File Storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tSwift、CephFS、HDFS、NFS、CIFS、Samba、FTP\n")])])]),s("p",[t._v("对象存储")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t其核心是将 数据读或写 和 元数据 分离，并且基于对象存储设备"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Object-based Storage Device，OSD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("构建存储系统，然后借助于对象存储设备的管理功能，自动管理该设备上的数据分布。\n\t对象存储主要包括四部分：对象、对象存储设备、元数据服务器、对象存储系统的客户端\n\t\n\t简单地说，块存储读写块，不利于共享，文件存储读写慢，利于共享，而对象存储综合了两者的优点。\n\t常见的解决方案：\n\t\tAS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Azure Storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GCS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Google Cloud Storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、S3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Simple Storage Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tSwift、Ceph OSD\n")])])]),s("p",[s("strong",[t._v("Ceph简介")])]),t._v(" "),s("p",[t._v("官方介绍")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\tCeph is the future of storage; where traditional(传统的) systems fail to deliver, Ceph is designed to excel(出色). Leverage(利用) your data for better business(业务) decisions(决策) and achieve(实现) operational(运营) excellence(卓越) through scalable, intelligent(智能), reliable(可靠) and highly available(可用) storage software. Ceph supports object, block and file storage, all in one unified(统一) storage system.\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("来源：\n\tCeph项目最早起源于Sage就读博士期间的工作（最早的成果于2004年发表，论文发表于2006年），并随后贡献给开源社区。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("参考资料：\n\t官方地址：https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/en/\n\t官方文档：https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/en/latest/"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\tgithub地址：https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/ceph/ceph\n\t最新版本：Quincy-17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2022-04-19"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、Pacific-16"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2021-03-31"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、Octopus-15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2020-03-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t系统支持：\n\t\t全系列最好的系统支持是Ubuntu\n\t\tCeph的发展对于Centos系列和Redhat系列不友好，新版本不支持旧版本系统。\n")])])]),s("p",[s("img",{attrs:{src:"image/image-20220923170114091.png",alt:"image-20220923170114091"}})]),t._v(" "),s("p",[t._v("软件特点")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/image-20220923163720189.png",alt:"image-20220923163720189"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("为什么很多人用ceph？\n\t1 创新，Ceph能够同时提供对象存储、块存储和文件系统存储三种存储服务的统一存储架构\n\t2 算法，Ceph得以摒弃了传统的集中式存储元数据寻址方案，通过Crush算法的寻址操作，有相当强大的扩展性。\n\t3 可靠，Ceph中的数据副本数量可以由管理员自行定义，并可以通过Crush算法指定副本的物理存储位置以分隔故障域，支持数据强一致性的特性也使Ceph具有了高可靠性，可以忍受多种故障场景并自动尝试并行修复。\n")])])]),s("p",[t._v("基本结构")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636088249032.png",alt:"1636088249032"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tCeph是一个多版本存储系统，它把每一个待管理的数据流（例如一个文件） 切分为一到多个固定大小的对象数据，并以其为原子单元完成数据存取。\n\t对象数据的底层存储服务是由多个主机（host）组成的存储集群，该集群也被称之为 RADOS（Reliable Automatic Distributed Object Store）存储集群，即可靠、自动化、 分布式对象存储系统 \n\tlibrados是RADOS存储集群的API，它支持C、C+"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("、Java、Python、Ruby和PHP等编程语言。\n")])])]),s("p",[t._v("应用场景")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\tCeph uniquely(独特的) delivers object, block, and file storage in one unified(统一) system. \n\t注意：这个介绍在官网这几年基本没有变化\n")])])]),s("p",[s("img",{attrs:{src:"image/1636099032730.png",alt:"1636099032730"}})]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\tRadosGW、RBD和CephFS都是RADOS存储服务的客户端，它们把RADOS的存储服务接口(librados)分别从不同的角度做了进一步抽象，因而各自适用于不同的应用场景。\n\t也就是说，ceph将三种存储类型统一在一个平台中，从而实现了更强大的适用性。\n")])])]),s("p",[s("img",{attrs:{src:"image/1636089258096.png",alt:"1636089258096"}})]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("LIBRADOS\t- 通过自编程方式实现数据的存储能力\nRADOSGW\t\t- 通过标准的RESTful接口，提供一种云存储服务\nRBD\t\t\t- 将ceph提供的空间，模拟出来一个一个的独立块设备使用。\n\t\t\t\t而且，ceph环境部署完毕后，服务端就准备好了rbd接口\nCFS\t\t\t- 通过一个标准的文件系统接口来进行数据的存储\n\n参考图例：https://docs.ceph.com/en/pacific/_images/stack.png\n")])])]),s("p",[s("img",{attrs:{src:"image/image-20211110140906074.png",alt:"image-20211110140906074"}})]),t._v(" "),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-1-4-组件解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4-组件解析"}},[t._v("#")]),t._v(" 1.1.4 组件解析")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 组件介绍、流程解读、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("组件介绍")])]),t._v(" "),s("p",[t._v("组件简介")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\t无论您是想向云平台提供 Ceph 对象存储和 Ceph 块设备服务、部署 Ceph 文件系统还是将 Ceph 用于其他目的，所有 Ceph 存储集群部署都从设置每个 Ceph 节点、您的网络和 Ceph 开始 存储集群。\n    一个 Ceph 存储集群至少需要一个 Ceph Monitor、Ceph Manager 和 Ceph OSD（对象存储守护进程）。 运行 Ceph 文件系统客户端时也需要 Ceph 元数据服务器。\n")])])]),s("p",[s("img",{attrs:{src:"image/1636099270839.png",alt:"1636099270839"}})]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("组件")]),t._v(" "),s("th",[t._v("解析")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Monitors")]),t._v(" "),s("td",[t._v("Ceph Monitor (守护进程ceph-mon) 维护集群状态的映射，包括监视器映射、管理器映射、OSD 映射、MDS 映射和 CRUSH 映射。 这些映射是 Ceph 守护进程相互协调所需的关键集群状态。 监视器还负责管理守护进程和客户端之间的身份验证。 通常至少需要三个监视器才能实现冗余和高可用性。基于 paxos 协议实现节点间的信息同步。")])]),t._v(" "),s("tr",[s("td",[t._v("Managers")]),t._v(" "),s("td",[t._v("Ceph 管理器 (守护进程ceph-mgr) 负责跟踪运行时指标和 Ceph 集群的当前状态，包括存储利用率、当前性能指标和系统负载。 Ceph 管理器守护进程还托管基于 Python 的模块来管理和公开 Ceph 集群信息，包括基于 Web 的 Ceph 仪表板和 REST API。 高可用性通常至少需要两个管理器。基于 raft 协议实现节点间的信息同步。")])]),t._v(" "),s("tr",[s("td",[t._v("Ceph OSDs")]),t._v(" "),s("td",[t._v("Ceph OSD（对象存储守护进程，ceph-osd）存储数据，处理数据复制、恢复、重新平衡，并通过检查其他 Ceph OSD 守护进程的心跳来向 Ceph 监视器和管理器提供一些监控信息。 通常至少需要 3 个 Ceph OSD 来实现冗余和高可用性。本质上osd就是一个个host主机上的存储磁盘。")])]),t._v(" "),s("tr",[s("td",[t._v("MDSs")]),t._v(" "),s("td",[t._v("Ceph 元数据服务器（MDS[Metadata Server]、ceph-mds）代表 Ceph 文件系统存储元数据。 Ceph 元数据服务器允许 POSIX（为应用程序提供的接口标准） 文件系统用户执行基本命令（如 ls、find 等），而不会给 Ceph 存储集群带来巨大负担。")])]),t._v(" "),s("tr",[s("td",[t._v("PG")]),t._v(" "),s("td",[t._v("PG全称Placement Grouops，是一个逻辑的概念，一个PG包含多个OSD。引入PG这一层其实是为了更好的分配数据和定位数据。写数据的时候，写入主osd，冗余两份。")])])])]),t._v(" "),s("p",[s("strong",[t._v("流程解读")])]),t._v(" "),s("p",[t._v("综合效果图")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636104082951.png",alt:"1636104082951"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("Ceph 将数据作为对象存储在逻辑存储池中，主要包括两步：\n\t把对象数据 映射给 PG\t\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 计算出哪个归置组应该包含该对象\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 这部分功能是由Hash算法实现的\n\t把 PG 映射到 host的OSD \n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 计算出哪个 Ceph OSD Daemon 应该存储该归置组\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 这部分由 CRUSH算法来决定的，CRUSH 算法使 Ceph 存储集群能够动态扩展、重新平衡和恢复。\n")])])]),s("p",[t._v("数据存储逻辑")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636103641572.png",alt:"1636103641572"}})]),t._v(" "),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-1-5-存储原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-5-存储原理"}},[t._v("#")]),t._v(" 1.1.5 存储原理")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 存储解读、案例解读、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("存储解读")])]),t._v(" "),s("p",[t._v("存储数据")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tCeph 存储集群从 Ceph 客户端接收数据"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("无论是通过 Ceph 块设备、Ceph 对象存储、Ceph 文件系统还是您使用 librados 创建的自定义实现"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 这些数据存储为 RADOS 对象"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 每个对象都存储在一个对象存储设备上。\n\tCeph OSD 守护进程处理存储驱动器上的读、写和复制操作。它主要基于两种文件方式实现：\n    \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Filestore方式，每个 RADOS 对象都作为一个单独的文件存储在传统文件系统（通常是 XFS）上。 \n    \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" BlueStore方式，对象以类似整体数据库的方式存储，这是新版本ceph默认的存储方式。\n\t\n\t注意：在Ceph中，每一个文件都会被拆分为多个独立的object，然后按照上面的逻辑进行持久化。\n")])])]),s("p",[s("img",{attrs:{src:"image/1636104261047.png",alt:"1636104261047"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tCeph OSD 守护进程将"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"数据"')]),t._v("作为对象存储在平面命名空间中"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("该对象包括如下部分：\n\t\t标识符\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 在内存中唯一查找的标识\n\t\t二进制数据 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 每个对象的真实数据\n\t\t属性数据 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 由一组名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("值对组成的元数据，语义完全取决于 Ceph 客户端。 \n\t例如，CephFS 使用元数据来存储文件属性，例如文件所有者、创建日期、上次修改日期等。\n\t\n注意：\n\t对象 ID 在整个集群中是唯一的，而不仅仅是本地文件系统"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"image/1636104309671.png",alt:"1636104309671"}})]),t._v(" "),s("p",[s("strong",[t._v("案例解读")])]),t._v(" "),s("p",[t._v("存储示例")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("存储一个大小为16M的文件，存储的时候，需要首先进行切割，假设每个对象"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("大小为4M"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("然后通过hash方式将object存储到对应的PG上，然后通过 CRUSH 策略将对应的数据关联到不同的host上。\n\t这个时候遇到一个问题：osd是一个磁盘设备，那么如何来进行存储数据\n\t\n常见的处理措施主要有两种：\n\t第一种：将osd格式化为文件系统，然后挂载到对应目录，然后就可以使用了\n\t第二种：osd有自己的守护进程，那么直接在守护进程空间中实现数据的处理\n")])])]),s("p",[t._v("方法1 - FileStore")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636105592444.png",alt:"1636105592444"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("这个时候，osd就变成一个文件系统中的文件"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("目录"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("了。\n\t因此，OSD需要维护object的对象属性信息，object的元数据保存到 osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("文件系统"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("的元数据区。\n\t但是文件系统的元数据区只能存放文件的 属主、属组、权限、时间戳等信息。对于ceph来说，object的元数据信息却包含很多相关信息，那么这些数据保存到哪里？\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("那么为了保存文件系统默认能够保存的数据之外的元数据"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("object对象的其他元数据信息"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，我们就需要将OSD做成一个XFS文件系统，在这个文件系统中，需要有一个单独的数据库"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LevelDB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，来维护ceph的元数据信息，效果如下\n")])])]),s("p",[s("img",{attrs:{src:"image/1636106662704.png",alt:"1636106662704"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("由于这种方式是基于文件系统映射的方式来实现 ceph的属性存储，所以我们把这种文件的存储方式称为 FiltStore。\n劣势：\n\t由于我们的object本来已经称为对象了，而在FileStore中，我们需要将其转换为文件方式来进行数据属性的存储，所以效率有些慢\n\t\n附注：\n\tXFS是被开发用于高容量磁盘以及高性能文件系统之用的。主要规划为三个部分：\n\t资料区（"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" section）"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 存储包括inode、block、superblock等数据\n\t文件系统活动登录区（log section） "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 用来记录文件系统的变化\n\t实时运作（realtime section）"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 数据真正存储的地方\n")])])]),s("p",[t._v("方法2 - BlueStore")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t因为osd对象是由一个ceph-osd守护进程来实现存储数据、处理数据复制、恢复、重新平衡等管理操作的。所以新版的Ceph的osd进程中，维护了一个RocksDB用于存储objects的元数据属性信息"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\tRocksDB为了实现数据的存储还需要一个文件系统，所以Ceph就为它开发了一个文件系统 BlueFS。\n\t\n\tRocksDB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" BlueFS 共同实现了objects的元数据的存储，所以我们把这种存储方式称为 BlueStore。新版的Ceph的存储机制，默认采用的就是 BlueStore机制。\n")])])]),s("p",[s("img",{attrs:{src:"image/1636107225026.png",alt:"1636107225026"}})]),t._v(" "),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h2",{attrs:{id:"_1-2-集群部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-集群部署"}},[t._v("#")]),t._v(" 1.2 集群部署")]),t._v(" "),s("h3",{attrs:{id:"_1-2-1-环境概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-环境概述"}},[t._v("#")]),t._v(" 1.2.1 环境概述")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 基础知识、环境规划、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("基础知识")])]),t._v(" "),s("p",[t._v("注意事项")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t在Ceph系统的搭建过程中"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("会出现各种意想不到或者预想到问题，就算整个过程中每一步都没问题，还是会出现各种问题，这些问题不仅仅在网上找不到，甚至在官网中找不到，甚至玩ceph数年的人都解决不了。\n\t尤其是，就算你第一次成功后，第二次重试就会出现问题。所以，如果出现问题怎么办？一步一步踏踏实实的进行研究，分析解决问题，并进行总结并梳理成册就可以了。\n")])])]),s("p",[t._v("简介")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("ceph的环境部署是非常繁琐的，所以，官方帮我们提供了很多的快捷部署方式。\n参考资料：\n\thttps:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/en/pacific/install/\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("推荐方法：\nCephadm \n\t使用容器和 systemd 安装和管理 Ceph 集群，并与 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CLI")]),t._v(" 和仪表板 GUI 紧密集成。\n\t仅支持 Octopus 和更新版本，需要容器和 Python3支持\n\t与新的编排 API 完全集成\nRook\n\t在 Kubernetes 中运行的 Ceph 集群，同时还支持通过 Kubernetes API 管理存储资源和配置。\n \t仅支持 Nautilus 和较新版本的 Ceph\n \t\n其他方法\nceph-ansible \t使用Ansible部署Ceph集群，对于新的编排器功能、管理功能和仪表板支持不好。\nceph-deploy \t是一个快速部署集群的工具，不支持Centos8\nDeepSea\t\t\t使用 Salt 安装 Ceph\nceph-mon\t\t使用 Juju 安装 Ceph\nPuppet-ceph\t\t通过 Puppet 安装 Ceph\n二进制源码\t\t 手工安装\nwindows图形\t   在windows主机上，通过鼠标点点点的方式进行部署。\n")])])]),s("p",[t._v("版本的选择")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("版本地址：https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/en/latest/releases/\n最新版本：官网版本 v16"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("10 Pacific\n版本特性：x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("开发版"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("候选版"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("稳定、修正版"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("环境规划")])]),t._v(" "),s("p",[t._v("网络规划")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/image-20211110140641473.png",alt:"image-20211110140641473"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("公有网络"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("：\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 用于用户的数据通信\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0/16\n集群网络"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("：\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 用于集群内部的管理通信\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0/16\n")])])]),s("p",[t._v("主机规划")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("磁盘规划\n\t磁盘1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" VM的系统盘\n\t磁盘2和磁盘3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Ceph的OSD\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("主机名规划\t\n\t主机名    公有网络     私有网络 \t  \t磁盘\t\t   其他角色\n\tadmin\t10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12\t192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12 \tsdb、sdc\n\tstor01\t10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13\t192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13  \tsdb、sdc\t\tmon01\n\tstor02\t10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("14\t192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("14  \tsdb、sdc\t\tmon02\n\tstor03\t10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15\t192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15 \tsdb、sdc \tmon03\n\tstor04\t10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("16\t192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("16  \tsdb、sdc\t\t\n\tstor05\t10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17\t192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17 \tsdb、sdc\n\tstor06\t10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18\t192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18  \tsdb、sdc\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("注意：\n\t由于生产中，ceph的集群角色是非常多的，当我们的主机量少的时候，只能让一台主机节点运行多个角色。\n\t\tstor01~03 这三台主机，还同时兼具 mon的角色，视情况兼容mgr角色\n\t\t主机名的完整格式是： xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com \n")])])]),s("p",[t._v("其他准备")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("管理用户\n\t由于我们接下来的所有操作，基本上都在 admin这个主机上来运行，所以，我们不推荐直接使用root用户来管理，倾向于通过一个普通用户来操作接下来的操作。\n\t由于后续的安装软件，涉及到root用户权限的操作，所以这个普通用户最好具备sudo的权限。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("时间同步\n\t对于任何一个集群来说，时间同步是非常重要的。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("主机名规划\n\t随着生产中的主机节点越来越多，我们通过手工定制主机名的方式就不太适合集群的主机管理了。所以在企业中，我们的主机名相关的信息，倾向于通过内网dns来进行管理。\n\t尤其是等我们到 radosgw的时候，必须通过泛域名解析的机制来实现，更强大的面向客户端的主机名管理体系。\n")])])]),s("p",[t._v("VM主机准备")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/image-20211108105810433.png",alt:"image-20211108105810433"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("所有节点都准备三块盘，两块网卡\n虚拟网络设置：\n\tVMnet1 设定为 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 网段， VMnet8 设定为 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 网段\n虚拟机设置\n\t额外添加两块盘，每个根据自己的情况设定容量，我这里设定为20G\n\t额外更加一块网络适配器，使用仅主机模式 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" VMnet1，mac地址必须要重新生成，避免冲突\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-2-准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-准备工作"}},[t._v("#")]),t._v(" 1.2.2 准备工作")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 基本环境、软件安装、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("基本环境")])]),t._v(" "),s("p",[t._v("主机名管理")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("编辑 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/hosts 文件\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12 admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com admin\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13 stor01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com stor01 mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com mon01\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("14 stor02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com stor02 mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com mon02\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15 stor03"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com stor03 mon03"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com mon03\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("16 stor04"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com stor04\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17 stor05"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com stor05\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18 stor06"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com stor06\n注意：\n\t后续可能会涉及到k8s环境的部署，所以hosts文件有可能会发生变动。\n")])])]),s("p",[t._v("防火墙管理")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("关闭防火墙\nsystemctl stop iptables firewalld \nsystemctl disable iptables firewalld\nsystemctl status iptables firewalld \n")])])]),s("p",[t._v("跨主机通信")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("脚本文件名称 01_remote_host_auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 功能: 批量设定远程主机免密码认证")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 版本: v0.2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作者: 书记")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 联系: superopsmsb.com")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 准备工作")]),t._v("\nuser_dir="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/root'")]),t._v("\nhost_file="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/etc/hosts'")]),t._v("\nlogin_user="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),t._v("\nlogin_pass="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),t._v("\ntarget_type="),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("部署 免密 同步 主机名 退出"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 菜单")]),t._v("\nmenu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[31m批量设定远程主机免密码认证管理界面\\e[0m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"====================================================="')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[32m 1: 部署环境   2: 免密认证   3: 同步hosts \\e[0m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[32m 4: 设定主机名 5：退出操作 \\e[0m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"====================================================="')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# expect环境")]),t._v("\nexpect_install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/expect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  then\n     "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33mexpect环境已经部署完毕\\e[0m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n     yum install expect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y >> "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/null 2>&1 && "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33mexpect软件安装完毕\\e[0m"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33mexpect软件安装失败\\e[0m"')]),t._v(" && "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  fi\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 秘钥文件生成环境")]),t._v("\ncreate_authkey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保证历史文件清空")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" && "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rf $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" mkdir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建秘钥文件对")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/ssh-keygen "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("t rsa "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("P "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/id_rsa\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33m秘钥文件已经创建完毕\\e[0m"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# expect自动匹配逻辑")]),t._v("\nexpect_autoauth_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收外部参数")]),t._v("\n  command="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$@"')]),t._v("\n  expect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\n    spawn ${command}\n    expect {\n      \\"')]),t._v("yes/no\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" {send \\"')]),t._v("yes\\r\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"; exp_continue}\n      \\"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("password*\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" {send \\"')]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_pass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\r\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"; exp_continue}\n      \\"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("password*\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" {send \\"')]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_pass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\r\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"}\n   }"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨主机传输文件认证")]),t._v("\nsshkey_auth_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收外部的参数")]),t._v("\n  local host_list="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$*"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ip in $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /usr/bin/ssh-copy-id -i ${user_dir}/.ssh/id_rsa.pub root@10.0.0.12")]),t._v("\n     cmd="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/bin/ssh-copy-id -i ${user_dir}/.ssh/id_rsa.pub"')]),t._v("\n     remote_host="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${login_user}@${ip}"')]),t._v("\n     expect_autoauth_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  done\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨主机同步hosts文件")]),t._v("\nscp_hosts_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收外部的参数")]),t._v("\n  local host_list="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$*"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ip in $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n     remote_host="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${login_user}@${ip}"')]),t._v("\n     scp $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(":$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  done\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨主机设定主机名规划")]),t._v("\nset_hostname_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收外部的参数")]),t._v("\n  local host_list="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$*"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ip in $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n     host_name=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("grep $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("awk "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $NF}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     remote_host="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${login_user}@${ip}"')]),t._v("\n     ssh $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hostnamectl set-hostname ${host_name}"')]),t._v("\n  done\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 帮助信息逻辑")]),t._v("\nUsage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入有效的操作id"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 逻辑入口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" true\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  menu\n  read "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入有效的操作id: "')]),t._v(" target_id\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#target_type[@]} -ge ${target_id} ]")]),t._v("\n  then\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"部署"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始部署环境操作..."')]),t._v("\n       expect_install\n       create_authkey\n    elif "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"免密"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       read "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入需要批量远程主机认证的主机列表范围(示例: {12..19}): "')]),t._v(" num_list\n       ip_list=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eval "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始执行免密认证操作..."')]),t._v("\n       sshkey_auth_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ip_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    elif "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"同步"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       read "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入需要批量远程主机同步hosts的主机列表范围(示例: {12..19}): "')]),t._v(" num_list\n       ip_list=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eval "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始执行同步hosts文件操作..."')]),t._v("\n       scp_hosts_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ip_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    elif "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"主机名"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       read "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入需要批量设定远程主机主机名的主机列表范围(示例: {12..19}): "')]),t._v(" num_list\n       ip_list=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eval "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始执行设定主机名操作..."')]),t._v("\n       set_hostname_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ip_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    elif "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"退出"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始退出管理界面..."')]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),t._v("\n    fi\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    Usage\n  fi\ndone\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("执行脚本文件\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@localhost ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /bin/bash /data/scripts/01_remote_host_auth.sh")]),t._v("\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 同步hosts\n 4: 设定主机名 5：退出操作\n=====================================================\n请输入有效的操作id: 1\n开始部署环境操作"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nexpect环境已经部署完毕\nGenerating public/private rsa key pair"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nYour identification has been saved in "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/id_rsa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nYour public key has been saved in "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/id_rsa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nThe key fingerprint is:\nSHA256:DNQAfWAD3MYPywK4W0BrNsgK+u3ysliuI6QdF3BOuyc root@localhost\nThe key"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s randomart image is:\n+---[RSA 2048]----+\n|.o .o**+         |\n|= + +o*.o        |\n|oO * +.=         |\n|B o = oo.        |\n|oo   +  S        |\n|.o..E .          |\n|o.oo.o           |\n|+++.             |\n|+oo=o            |\n+----[SHA256]-----+\n秘钥文件已经创建完毕\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 同步hosts\n 4: 设定主机名 5：退出操作\n=====================================================\n请输入有效的操作id: 2\n请输入需要批量远程主机认证的主机列表范围(示例: {12..19}): {12..18}\n开始执行免密认证操作...\n...\nNow try logging into the machine, with:   \"ssh '")]),t._v("root@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"\nand check to make sure that only the key(s) you wanted were added.\n...\nNow try logging into the machine, with:   \"ssh '")]),t._v("root@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18'\"\nand check to make sure that only the key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" you wanted were added"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 同步hosts\n 4: 设定主机名 5：退出操作\n=====================================================\n请输入有效的操作id: 3\n请输入需要批量远程主机同步hosts的主机列表范围"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("示例: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("19"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n开始执行同步hosts文件操作"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nhosts \t100%  520     1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2MB/s   00:00\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nhosts\t100%  520   403"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("3KB/s   00:00\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 同步hosts\n 4: 设定主机名 5：退出操作\n=====================================================\n请输入有效的操作id: 4\n请输入需要批量设定远程主机主机名的主机列表范围"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("示例: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("19"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n开始执行设定主机名操作"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 同步hosts\n 4: 设定主机名 5：退出操作\n=====================================================\n请输入有效的操作id: 5\n开始退出管理界面"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("测试效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@localhost ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# for i in {12..18}; do hostname=$(ssh root@10.0.0.$i "hostname"); echo "10.0.0.$i - $hostname"; done')]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" admin\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" mon01\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("14 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" mon02\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" mon03\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("16 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" stor04\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" stor05\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" stor06\n")])])]),s("p",[s("strong",[t._v("软件安装")])]),t._v(" "),s("p",[t._v("用户管理")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("创建普通用户\nuseradd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m cephadm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/bash\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" cephadm:123456 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" chpasswd\n\n为用户配置root权限\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cephadm ALL = (root) NOPASSWD:ALL"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" sudo "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/sudoers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d/cephadm \nchmod 0440 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/sudoers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d/cephadm\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("切换用户时候不输出最近登录信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@admin ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# grep  "se.*postlogin" /etc/pam.d/su')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# session               include         postlogin")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("脚本方法 02_create_ceph_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 功能: 创建专属的ceph管理用户")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 版本: v0.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作者: 书记")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 联系: superopsmsb.com")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 准备工作")]),t._v("\nlogin_user="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cephadm'")]),t._v("\nlogin_pass="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定普通用户")]),t._v("\nuseradd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/bash\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(":$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_pass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" chpasswd\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${login_user} ALL = (root) NOPASSWD:ALL"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" sudo "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/sudoers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d/$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \nchmod 0440 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/sudoers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d/$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("批量执行\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  ssh root@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mkdir /data/scripts -p"')]),t._v("\n  scp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scripts/02_create_ceph_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh root@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scripts/02_create_ceph_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh\n  ssh root@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/bash /data/scripts/02_create_ceph_user.sh"')]),t._v("\ndone\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("确认效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@localhost ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# for i in {12..18}; do usermsg=$(ssh root@10.0.0.$i "id cephadm"); echo "10.0.0.$i - $usermsg"; done')]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 组=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 组=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("14 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 组=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 组=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("16 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 组=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 组=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gid=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 组=1001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cephadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("跨主机免密码认证")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("脚本文件内容 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scripts/03_remote_cephadm_auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 功能: 批量设定远程主机免密码认证")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 版本: v0.3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作者: 书记")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 联系: superopsmsb.com")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 准备工作")]),t._v("\nuser_dir="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/home/cephadm'")]),t._v("\nlogin_user="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cephadm'")]),t._v("\nlogin_pass="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),t._v("\nhost_file="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/etc/hosts'")]),t._v("\ntarget_type="),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("部署 免密 退出"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 菜单")]),t._v("\nmenu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[31m批量设定远程主机免密码认证管理界面\\e[0m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"====================================================="')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[32m 1: 部署环境   2: 免密认证   3: 退出操作 \\e[0m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"====================================================="')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# expect环境")]),t._v("\nexpect_install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/expect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  then\n     "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33mexpect环境已经部署完毕\\e[0m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n     sudo yum install expect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y >> "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/null 2>&1 && "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33mexpect软件安装完毕\\e[0m"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33mexpect软件安装失败\\e[0m"')]),t._v(" && "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  fi\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 秘钥文件生成环境")]),t._v("\ncreate_authkey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保证历史文件清空")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" && "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rf $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建秘钥文件对")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/ssh-keygen "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("t rsa "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("P "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/id_rsa\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\e[33m秘钥文件已经创建完毕\\e[0m"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# expect自动匹配逻辑")]),t._v("\nexpect_autoauth_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收外部参数")]),t._v("\n  command="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$@"')]),t._v("\n  expect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\n    spawn ${command}\n    expect {\n      \\"')]),t._v("yes/no\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" {send \\"')]),t._v("yes\\r\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"; exp_continue}\n      \\"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("password*\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" {send \\"')]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_pass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\r\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"; exp_continue}\n      \\"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("password*\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" {send \\"')]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login_pass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\r\\"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"}\n   }"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨主机传输文件认证")]),t._v("\nsshkey_auth_func"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收外部的参数")]),t._v("\n  local host_list="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$*"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ip in $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /usr/bin/ssh-copy-id -i ${user_dir}/.ssh/id_rsa.pub root@10.0.0.12")]),t._v("\n     cmd="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/bin/ssh-copy-id -i ${user_dir}/.ssh/id_rsa.pub"')]),t._v("\n     remote_host="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${login_user}@${ip}"')]),t._v("\n     host_name=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("grep $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("awk "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $NF}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     remote_host1="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${login_user}@${host_name}"')]),t._v("\n     remote_host2="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${login_user}@${host_name}.superopsmsb.com"')]),t._v("\n     expect_autoauth_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     expect_autoauth_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_host1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     expect_autoauth_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_host2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  done\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 帮助信息逻辑")]),t._v("\nUsage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入有效的操作id"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 逻辑入口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" true\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  menu\n  read "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入有效的操作id: "')]),t._v(" target_id\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#target_type[@]} -ge ${target_id} ]")]),t._v("\n  then\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"部署"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始部署环境操作..."')]),t._v("\n       expect_install\n       create_authkey\n    elif "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"免密"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       read "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请输入需要批量远程主机认证的主机列表范围(示例: {12..19}): "')]),t._v(" num_list\n       ip_list=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eval "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始执行免密认证操作..."')]),t._v("\n       sshkey_auth_func $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ip_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    elif "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("target_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" == "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"退出"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    then\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始退出管理界面..."')]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),t._v("\n    fi\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    Usage\n  fi\ndone\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("更改文件权限\nchown cephadm:cephadm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scripts/03_remote_cephadm_auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh\n\n切换用户\nsu "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" cephadm\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("执行脚本文件\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ~]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/bash "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scripts/03_remote_cephadm_auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 退出操作\n=====================================================\n请输入有效的操作id: 1\n开始部署环境操作"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nexpect环境已经部署完毕\nGenerating public/private rsa key pair"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nYour identification has been saved in "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/id_rsa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nYour public key has been saved in "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh/id_rsa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nThe key fingerprint is:\nSHA256:EvrdtcF4q+e2iyVVOovFkoHOisorCem+1eSG7WO+NCQ cephadm@admin\nThe key"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s randomart image is:\n+---[RSA 2048]----+\n|                 |\n|         .       |\n|      . . .   .  |\n|     . +   * o   |\n| . E.o. S + @    |\n|o   Oo + . B *   |\n|o. o.Bo . + =    |\n|oo..+o.    =o    |\n|.+=.o+o   o++o   |\n+----[SHA256]-----+\n秘钥文件已经创建完毕\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 退出操作\n=====================================================\n请输入有效的操作id: 2\n请输入需要批量远程主机认证的主机列表范围(示例: {12..19}): {12..18}\n开始执行免密认证操作...\n...\nNow try logging into the machine, with:   \"ssh '")]),t._v("cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18'\"\nand check to make sure that only the key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" you wanted were added"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n批量设定远程主机免密码认证管理界面\n=====================================================\n 1: 部署环境   2: 免密认证   3: 退出操作\n=====================================================\n请输入有效的操作id: 3\n开始退出管理界面"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("测试效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ~]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" hostname=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ssh cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hostname"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.0.0.'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" - "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$hostname")]),t._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("12 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" admin\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" mon01\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("14 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" mon02\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" mon03\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("16 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" stor04\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" stor05\n10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" stor06\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("因为10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13-15 有两个角色，所以我们需要将相关角色的免密认证\nnum_list="),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eval "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" stor0"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num_list")]),t._v(" stor0"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh-"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("copy-id")]),t._v(" cephadm@"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n")])])]),s("p",[t._v("定制软件源")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t对于ceph-deploy方式部署Ceph来说，Ceph的官方仓库路径是http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/，包括各种ceph版本，比如octopus、pacific、quincy等，它根据不同OS系统环境，分别位于rpm-版本号 或者 debian-版本号 的noarch目录下。比如pacific版本的软件相关源在 rpm-octopus/el7/noarch/ceph-release-1-1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("noarch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rpm。\n\t注意：\n\t\tel7代表支持Red Hat 7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x、CentOS 7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x 系统的软件\n\t\tel8代表支持Red Hat 8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x、CentOS 8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x 系统的软件\n\t\tpacific版本及其更新版本，只支持CentOS 8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x环境\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tCeph的pacific和Quincy版本，仅仅支持CentOS8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("X，Octopus版本虽然有CentOS7的版本，不仅仅软件不全，而且对于底层GCC库和GLIBC库要求比较高，如果升级CentOS7的底层库，会导致其他软件受到影响，无法正常使用，另外没有配套的ceph-deploy。所以对于CentOS7来说，只能部署Nautilus版本和更低版本。\n\t对于Ubuntu系统来说，即使多个版本对于底层环境要求有些区别，但是经过测试，问题不大，也就是说Ubuntu系统可以安装Ceph的全系列\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("安装软件源\nyum install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mirrors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aliyun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/ceph/rpm-nautilus/el7/noarch/ceph-release-1-1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("noarch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rpm\n\n更新软件源\nyum makecache fast\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("所有ceph节点部署软件源\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" \n  ssh root@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" yum install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y  https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mirrors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aliyun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/ceph/rpm-nautilus/el7/noarch/ceph-release-1-1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("noarch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rpm\n  ssh root@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" yum makecache fast\ndone\n")])])]),s("p",[t._v("部署依赖")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("admin主机安装ceph软件\nyum update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y\nyum install  ceph-deploy python-setuptools python2-subprocess32 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y\n\n测试效果\nsu "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" cephadm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ceph-deploy --help"')]),t._v("\n")])])]),s("p",[t._v("命令解析")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看命令帮助\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@admin ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# su - cephadm")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ~]")]),t._v("$ ceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help\nusage: ceph-deploy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("username USERNAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("ceph-conf CEPH_CONF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                   COMMAND "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\nEasy Ceph deployment\n\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("^"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("   \\\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("O o"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("  ceph-deploy v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("25\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/|||\\`\n  | '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n    '"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("`\n\nFull documentation can be found at: http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/ceph-deploy/docs\n\noptional arguments:\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help            show this help message and "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("verbose         be more verbose\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("quiet           be less verbose\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("version             the current installed version of ceph-deploy\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("username USERNAME   the username to connect to the remote host\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf      overwrite an existing conf file on remote host "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v("\n                        present"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster NAME        name of the cluster\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("ceph-conf CEPH_CONF\n                        use "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("or reuse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a given ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf file\n\ncommands:\n  COMMAND               description\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建一个集群")]),t._v("\n    new                 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),t._v(" deploying a new cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" and "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" a\n                        CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf and keyring "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" it"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    install             Install Ceph packages on remote hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    rgw                 Deploy ceph RGW on remote hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    mds                 Deploy ceph MDS on remote hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    mon                 Deploy ceph monitor on remote hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    gatherkeys          Gather authentication keys "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" provisioning new nodes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    disk                Manage disks on a remote host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    osd                 Prepare a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" disk on remote host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 同步admin秘钥信息")]),t._v("\n    admin               Push configuration and client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin key to a remote host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 同步ceph.conf文件")]),t._v("\n    config              Push configuration file to a remote host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    uninstall           Remove Ceph packages "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" remote hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    purgedata           Purge "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delete"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" destroy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" discard"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shred"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" any Ceph "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib/ceph\n    purge               Remove Ceph packages "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" remote hosts and purge all "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    forgetkeys          Remove authentication keys "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" the local directory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    pkg                 Manage packages on remote hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    calamari            Install and configure Calamari nodes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Assumes that a\n                        repository with Calamari packages is already\n                        configured"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Refer to the docs "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" examples\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com/ceph-deploy/docs/conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-3-ceph部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-ceph部署"}},[t._v("#")]),t._v(" 1.2.3 Ceph部署")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 集群创建、Mon环境、小结 三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("集群创建")])]),t._v(" "),s("p",[t._v("准备工作")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("首先在管理节点上以cephadm用户创建集群相关的配置文件目录：\nsu "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" cephadm\nmkdir ceph-cluster && cd ceph-cluster\n")])])]),s("p",[t._v("初始化集群解析")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("操作解析\n\tceph-deploy new "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help\n\t初始化第一个MON节点的命令格式为”ceph-deploy new "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("initial-monitor-node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("“，\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" mon01即为第一个MON节点名称，其名称必须与节点当前实际使用的主机名称"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("保存一致\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 可以是短名称，也可以是长名称，但是最终用的仍然是短名称"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("但是会导致如下报错：\n\t\t\tceph-deploy new: error: hostname:  xxx is not resolvable\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 推荐使用完整写法：\n\t\t\t格式 hostname:fqdn，比如 mon01:mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n注意：\n\t如果初始化的时候，希望同时部署多个节点的换，使用空格隔开hostname:fqdn即可\n\t如果部署过程出现问题，需要清空\n        ceph-deploy forgetkeys\n        ceph-deploy purge mon01\n        ceph-deploy purgedata mon01\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n")])])]),s("p",[t._v("集群初始化")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("部署3个mon节点\n\t"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy new "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("public-network 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0/24 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster-network 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0/24 mon01:mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com mon02:mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com mon03:mon03"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("no-ssh-copykey\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.new]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Resolving host mon03"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superopsmsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n    "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.new]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Monitor mon03 at 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15\n    "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.new]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Monitor initial members are "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mon01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mon02'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mon03'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.new]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Monitor addrs are "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("u"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.0.0.13'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.0.0.14'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.0.0.15'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.new]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Creating a random mon key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.new]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Writing monitor keyring to ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.new]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Writing initial config to ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("注意：\n\t如果出现如下报错：\n\t"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ERROR ]")]),t._v(" AttributeError: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'module'")]),t._v(" object has no attribute "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'needs_ssh'")]),t._v("\n\t在执行命令的时候，添加一个 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("no-ssh-copykey 参数即可\n\t这主要是因为免密认证的时候，没有进行 ssh cephadm@主机名 导致的\n")])])]),s("p",[t._v("查看效果")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看初始化后的文件内容\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf  ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n\n查看集群的配置文件\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[global]")]),t._v("\nfsid = 7738ce65-2d87-481c-8253-9d0d4b29e8eb  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这个地方很重要的，每次都不一样，不要乱动")]),t._v("\npublic_network = 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0/24\ncluster_network = 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0/24\nmon_initial_members = mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mon03\nmon_host = 10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("14"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15\nauth_cluster_required = cephx\nauth_service_required = cephx\nauth_client_required = cephx\nfilestore_xattr_use_omap = true\n\n查看集群通信的认证信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon.]")]),t._v("\nkey = AQBZ9y1jAAAAABAAKnVONZ3l+EEpjUOjtK8Xmw==\ncaps mon = allow "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\n查看集群初始化的日志信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[s("strong",[t._v("部署Mon")])]),t._v(" "),s("p",[t._v("部署mon软件")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("操作解析：\n\tceph-deploy命令能够以远程的方式连入Ceph集群各节点完成程序包安装等操作\n\t\n命令格式：\n\tceph-deploy install "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ceph-node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ceph-node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t示例：ceph-deploy install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("nogpgcheck admin mon01 mon02 mon03\n\t注意：\n\t\t这里主要是ceph的工作角色的的节点\n\t\t一般情况下，不推荐使用这种直接的方法来进行安装，效率太低，而且容易干扰其他主机环境\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("注意：\t\n\t上面会在所有节点上都来进行正常的安装部署其实还有另外一种方法，手工在所有节点上安装ceph软件"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 推荐\n\tyum install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y ceph ceph-osd ceph-mds ceph-mon ceph-radosgw\n\t\n\t最后在admin角色主机上安装\n\tceph-deploy install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("no-adjust-repos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("nogpgcheck admin mon01 mon02 mon03\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("执行过程\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("no-adjust-repos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("nogpgcheck admin mon01 mon02 mon03\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Invoked "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("25"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/ceph-deploy install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("no-adjust-repos admin mon01 mon02 mon03\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.install]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Installing stable version hammer on cluster ceph hosts admin mon01 mon02 mon03\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.install]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Detecting platform "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" host mon01 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[admin]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" connection detected need "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" sudo\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[admin]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" connected to host: admin\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" 完毕！\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("version\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" ceph version 14"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("22 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ca74598065096e6fcbd8433c8779a2be0c889351"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" nautilus "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("集群通信认证")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("配置初始MON节点"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("同时向所有节点同步配置\nceph-deploy mon create-initial\n注意：\n\t为了避免因为认证方面导致的通信失败，尤其是在现有环境上，推荐使用 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf 参数\n\tceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf config push mon01 mon02 mon03\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("执行效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy mon create-initial\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Invoked "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/ceph-deploy mon create-initial\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" status "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" monitor: mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon01\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"election_epoch"')]),t._v(": 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extra_probe_peers"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"feature_map"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"features"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monmap"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mons"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"addr"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.0.0.13:6789/0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mon01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"public_addr"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.0.0.13:6789/0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"public_addrs"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"addrvec"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"addr"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.0.0.13:3300"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nonce"')]),t._v(": 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v2"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"addr"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.0.0.13:6789"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nonce"')]),t._v(": 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rank"')]),t._v(": 0\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"addr"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:0/1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mon02"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rank"')]),t._v(": 1\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"addr"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:0/2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mon03"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rank"')]),t._v(": 2\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mon01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"outside_quorum"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mon01"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"quorum"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rank"')]),t._v(": 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"state"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"probing"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sync_provider"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" monitor: mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon01 is running\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster=ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("admin-daemon "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("run/ceph/ceph-mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asok mon_status\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.gatherkeys]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Storing ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.gatherkeys]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Storing ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-rgw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.gatherkeys]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Destroy temp directory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("tmp/tmpyal7qW\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("到mon的节点上查看mon的守护进程\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ps aux | grep -v grep | grep ceph-mon"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\nceph        2189  0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8 504004 34644 ?        Ssl  11:55   0:00 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/ceph-mon "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("id mon01 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setuser ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setgroup ceph\nceph        2288  0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("7 502984 33328 ?        Ssl  11:55   0:00 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/ceph-mon "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("id mon02 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setuser ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setgroup ceph\nceph        2203  0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("7 502988 32912 ?        Ssl  11:55   0:00 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/ceph-mon "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("id mon03 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setuser ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setgroup ceph\n结果显示：\n\t在所有的节点主机上，都有一套ceph-mon的进程在进行。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("集群在初始化的时候，会为对应的mon节点生成配套的认证信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/ceph-cluster\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-mds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring  ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring  ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring  \nceph-deploy-ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log \t\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-mgr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring  ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-rgw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf                  \tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("结果显示：\n\t这里生成了一系列的与ceph集群相关的 认证文件\n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-mds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\t\t引导启动 mds的秘钥文件\n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\t\t引导启动 osd的秘钥文件\n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\t\tceph客户端和管理端通信的认证秘钥，是最重要的\n\tceph-deploy-ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log\t\t   \n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-mgr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\t\t引导启动 mgr的秘钥文件\n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bootstrap-rgw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\t\t引导启动 rgw的秘钥文件\n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n\t注意：\n\t\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring 拥有ceph集群的所有权限，一定不能有误。\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-4-ceph部署2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-ceph部署2"}},[t._v("#")]),t._v(" 1.2.4 Ceph部署2")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 Mon认证、Mgr环境、小结、三个方面来学习")]),t._v(" "),s("p",[s("strong",[t._v("Mon认证")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t为了方便后续的监控环境认证操作，在admin角色主机上，把配置文件和admin密钥拷贝Ceph集群各监控角色节点"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("拷贝前秘钥文件前的各个mon节点效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo -----'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v('-----; ls /etc/ceph"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("13-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\nrbdmap\ntmpc8lO0G\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("14-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\nrbdmap\ntmpkmxmh3\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("15-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\nrbdmap\ntmp4GwYSs\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("原则上要求，所有mon节点上的 ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf 内容必须一致，如果不一致的话，可以通过下面命令同步\n\tceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf config push mon01 mon02 mon03\n\t\n执行集群的认证文件的拷贝动作\nceph-deploy admin mon01 mon02 mon03\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("执行认证文件信息同步\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy admin mon01 mon02 mon03\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.admin]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Pushing admin keys and conf to mon01\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" cluster configuration to "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.admin]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Pushing admin keys and conf to mon02\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon02]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" cluster configuration to "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.admin]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Pushing admin keys and conf to mon03\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" cluster configuration to "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo -----'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v('-----; ls /etc/ceph"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("13-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\nrbdmap\ntmpc8lO0G\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("14-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\nrbdmap\ntmpkmxmh3\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("15-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\nrbdmap\ntmp4GwYSs\n结果显示：\n\t所有的mon节点上多了一个 ceph的客户端与服务端进行认证的秘钥文件了。\n\tceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring 主要用于 ceph客户端与管理端的一个通信认证。\n\t注意：如果我们不做交互式操作的话，这个文件可以不用复制。\n")])])]),s("p",[t._v("认证文件权限")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t虽然我们把认证文件传递给对应的监控角色主机了，但是我们的服务式通过普通用户cephadm来进行交流的。而默认情况下，传递过去的认证文件，cephadm普通用户是无法正常访问的\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo -----'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v('-----; ls /etc/ceph/ceph.cl* -l"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("13-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 1 root root 151 9月  25 12:06 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("14-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 1 root root 151 9月  25 12:06 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("15-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 1 root root 151 9月  25 12:06 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("我们需要在Ceph集群中需要运行ceph命令的的节点上，以root用户的身份设定普通用户cephadm能够读\n取"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring文件的权限。\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sudo setfacl -m u:cephadm:r /etc/ceph/ceph.client.admin.keyring"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n\n查看文件权限效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh cephadm@10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo -----'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v('-----; ls /etc/ceph/ceph.cl* -l"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("13-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" 1 root root 151 9月  25 12:06 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("14-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" 1 root root 151 9月  25 12:06 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("15-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" 1 root root 151 9月  25 12:06 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n\n查看文件的授权信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon01 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# getfacl /etc/ceph/ceph.client.admin.keyring")]),t._v("\ngetfacl: Removing leading "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" absolute path names\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# file: etc/ceph/ceph.client.admin.keyring")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# owner: root")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# group: root")]),t._v("\nuser::rw-\nuser:cephadm:r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),t._v("::"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\nmask::r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\nother::"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("监控节点就可以自己来收集相关的数据了，比如我们在mon01上执行如下命令\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon01 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph -s")]),t._v("\n  cluster:\n    id:     1d4e5773-619a-479d-861a-66ba451ce945\n    health: HEALTH_WARN\n            mons are allowing insecure global_id reclaim\n\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 18m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: no daemons active\n    osd: 0 osds: 0 up"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 in\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(":\n    pools:   0 pools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 pgs\n    objects: 0 objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 B\n    usage:   0 B used"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 B "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" 0 B avail\n    pgs:\n结果显示：\n\t我们的cluster状态不是正常的\n\t对于service来说，有三个mon服务，选举的节点有三个，其他的服务没有。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("集群状态不正常的原因，我们可以通过 ceph health命令来进行确认，效果如下\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon01 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph health")]),t._v("\nHEALTH_WARN mons are allowing insecure global_id reclaim\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon01 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph health detail")]),t._v("\nHEALTH_WARN mons are allowing insecure global_id reclaim\nAUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED mons are allowing insecure global_id reclaim\n    mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon01 has auth_allow_insecure_global_id_reclaim "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" to true\n    mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon02 has auth_allow_insecure_global_id_reclaim "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" to true\n    mon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mon03 has auth_allow_insecure_global_id_reclaim "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" to true\n结果显示：\n\t我们在所有的mon节点上进行提示属性的设定\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon01 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph config set mon auth_allow_insecure_global_id_reclaim false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon01 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph health detail")]),t._v("\nHEALTH_OK\n结果显示：\n\t集群状态问题已经解决了\n")])])]),s("p",[s("strong",[t._v("Mgr环境")])]),t._v(" "),s("p",[t._v("需求")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tCeph-MGR工作的模式是事件驱动型的，简单来说，就是等待事件，事件来了则处理事件返回结果，又继续等待。Ceph MGR 是 Ceph 12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2 依赖主推的功能之一，它负责 Ceph 集群管理的组件，它主要功能是把集群的一些指标暴露给外界使用。根据官方的架构原则上来说，mgr要有两个节点来进行工作。\n\t对于我们的学习环境来说，其实一个就能够正常使用了"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("为了节省资源的使用，我们这里将mon01 和mon02主机节点兼做MGR节点，为了后续的节点扩充实践，我们暂时先安装一个节点，后面再安装一个节点。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("未部署mgr节点的集群状态效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ssh mon01  ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    id:     1d4e5773-619a-479d-861a-66ba451ce945\n    health: HEALTH_OK\n\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 29m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: no daemons active\n    osd: 0 osds: 0 up"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 in\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(":\n    pools:   0 pools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 pgs\n    objects: 0 objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 B\n    usage:   0 B used"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 B "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" 0 B avail\n    pgs:\n")])])]),s("p",[t._v("mgr服务配置")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("配置Manager节点，启动ceph-mgr进程：\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy mgr create mon01\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Invoked "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/ceph-deploy mgr create mon01\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" ceph-deploy options:\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v("  mgr                           : "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mon01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mon01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo systemctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v(" ceph-mgr@mon\n\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("在指定的mgr节点上，查看守护进程\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ssh mon01 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v grep "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep ceph-mgr\nceph        3065  2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8  6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("6 1037824 124244 ?      Ssl  12:27   0:01 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/bin/ceph-mgr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("id mon01 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setuser ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("setgroup ceph\n结果显示：\n\t在mon01上，部署了一个mgr的服务进程\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看集群服务的运行状态\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ssh mon01  ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 33m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 86s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 0 osds: 0 up"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 in\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(":\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n结果显示：\n\t这个时候，service上，多了一个mgr的服务，在mon01节点上，服务状态是 active。\n")])])]),s("p",[t._v("admin查看状态")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("远程查看状态方式不太方便，我们可以在admin主机上进行一下操作来实现admin主机查看集群状态\nsudo yum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y install ceph-common\nceph-deploy admin admin\nsudo setfacl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m u:cephadm:rw "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/ceph/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyring\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("确认效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    id:     1d4e5773-619a-479d-861a-66ba451ce945\n    health: HEALTH_WARN\n            OSD count 0 < osd_pool_default_size 3\n\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 37m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 4m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 0 osds: 0 up"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 in\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(":\n    pools:   0 pools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 pgs\n    objects: 0 objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 B\n    usage:   0 B used"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 0 B "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" 0 B avail\n    pgs:\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-5-osd环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-osd环境"}},[t._v("#")]),t._v(" 1.2.5 OSD环境")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 基本环境、OSD实践、小结、三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("基本环境")])]),t._v(" "),s("p",[t._v("简介")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\t我们知道对于osd来说，它进行真正数据的存储的引擎有两种：BlueStore和FileStore，自动Ceph L版之后，默认都是BlueStore了。\n")])])]),s("p",[t._v("基本流程")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("一般来说，我们可以通过一下四个步骤来设置OSD环境：\n\t1 要知道对应的主机上有哪些磁盘可以提供给主机来进行正常的使用。\n\t2 格式化磁盘"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("非必须"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t3 ceph擦除磁盘上的数据\n\t4 添加osd\n")])])]),s("p",[t._v("1 确保提供专属数据磁盘，然后进行格式化")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("根据我们的了解，我们为所有的节点主机都准备了两块额外的磁盘，\nfdisk "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("l\n")])])]),s("p",[t._v("2 进行磁盘格式化")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("我们在所有的osd角色的主机上，进行磁盘的格式化操作"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("对所有的osd节点主机进行磁盘格式化。\nmkfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ext4  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdb\nmkfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ext4  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看磁盘格式化效果，以mon03为例\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# blkid | egrep "sd[bc]"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdb: UUID="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"49b5be7c-76dc-4ac7-a3e6-1f54526c83df"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v("="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ext4"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc: UUID="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ecdc0ce6-8045-4caa-b272-2607e70700ee"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v("="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ext4"')]),t._v("\n")])])]),s("p",[t._v("3 ceph擦除磁盘上的数据")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("保证所有包含OSD磁盘上主机上，安装ceph的命令\nyum install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y ceph radosgw\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("检查并列出OSD节点上所有可用的磁盘的相关信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy disk list stor01 stor02 stor03\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Invoked "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/ceph-deploy disk list stor01 stor02 stor03\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" connection detected need "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" sudo\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo fdisk "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("l\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor02]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" connection detected need "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" sudo\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor02]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo fdisk "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("l\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" connection detected need "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" sudo\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo fdisk "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("l\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("在管理节点上使用ceph-deploy命令擦除计划专用于OSD磁盘上的所有分区表和数据以便用于OSD，\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" \n   ceph-deploy disk zap stor0"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\ndone\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[WARNIN]")]),t._v("  stderr: 记录了10+0 的读入\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[WARNIN]")]),t._v(" 记录了10+0 的写出\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[WARNIN]")]),t._v(" 10485760字节"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("10 MB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("已复制\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[WARNIN]")]),t._v("  stderr: ，0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("018883 秒，555 MB/秒\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor03]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[WARNIN]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("> Zapping successful "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(": <Raw Device: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc>\n")])])]),s("p",[s("strong",[t._v("OSD实践")])]),t._v(" "),s("p",[t._v("命令解析")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("对于osd的相关操作，可以通过 ceph-deploy osd 命令来进行，帮助信息如下\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy osd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help\nusage: ceph-deploy osd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\nCreate OSDs "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" disk on a remote host:\n    ceph-deploy osd create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/device\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("For")]),t._v(" bluestore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" optional devices can be used::\n    ceph-deploy osd create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-db")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/db-device\n    ceph-deploy osd create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-wal")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/wal-device\n    ceph-deploy osd create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-db")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/db-device "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-wal")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/wal-device\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("For")]),t._v(" filestore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" the journal must be specified"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" as well as the objectstore::\n    ceph-deploy osd create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("filestore "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("journal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/journal\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("For")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" devices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" it can be an existing logical volume in the format of:\nvg/lv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" or a device"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("For")]),t._v(" other OSD components like wal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" and journal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" it\ncan be logical volume "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("in vg/lv format"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" or it must be a GPT partition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\npositional arguments:\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    list         List OSD info "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" remote host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    create       Create new Ceph OSD daemon by preparing and activating a device\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("帮助显示：这里提示了两类的存储机制：\n\t对于bluestore来说，它主要包括三类数据：\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v("\t\t\t\t\t\tceph 保存的对象数据\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-db")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/db-device \t\t     \tceph 保存的对象数据\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-wal")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/wal-device\t\t      \t数据库的 wal 日志\n\t对于filestore来说，它主要包括两类数据\t\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" \t\t  \t\t   \t\tceph的文件数据\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("journal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/journal\t\t\t     \t文件系统日志数据\n\t对于 osd来说，它主要有两个动作：\n\t\tlist\t列出osd相关的信息\n\t\tcreate\t创建osd设备\n")])])]),s("p",[t._v("添加OSD命令解读")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("对于osd的创建来说，我们来看一下他的基本格式\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy osd create "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help\nusage: ceph-deploy osd create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("journal JOURNAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("zap-disk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("fs-"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),t._v(" FS_TYPE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("dmcrypt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("dmcrypt-key-"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" KEYDIR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("filestore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("bluestore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-db")]),t._v(" BLOCK_DB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-wal")]),t._v(" BLOCK_WAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("debug"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                              "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[HOST]")]),t._v("\n\npositional arguments:\n  HOST                  Remote host to connect\n\noptional arguments:\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help            show this help message and "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATA")]),t._v("           The OSD "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" logical volume "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vg/lv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" or absolute path\n                        to device\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("journal JOURNAL     Logical Volume "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vg/lv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" or path to GPT partition\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("zap-disk            DEPRECATED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" cannot zap when creating an OSD\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("fs-"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),t._v(" FS_TYPE     filesystem to use to format DEVICE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" btrfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("dmcrypt             use dm-crypt on DEVICE\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("dmcrypt-key-"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" KEYDIR\n                        directory where dm-crypt keys are stored\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("filestore           filestore objectstore\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("bluestore           bluestore objectstore\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-db")]),t._v(" BLOCK_DB   bluestore block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db path\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("block-wal")]),t._v(" BLOCK_WAL\n                        bluestore block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wal path\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("debug               Enable debug mode on remote ceph-volume calls\n结果显示：\n\t对于osd的创建，默认情况下用的就是 bluestore类型，\n")])])]),s("p",[t._v("4 添加osd")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("创建osd，我们这里全部用于存储数据。\nceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf osd create stor01 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdb\nceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf osd create stor01 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n注意：\n\t这里只能一个磁盘一个磁盘的添加\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf osd create stor01 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Invoked "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/ceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf osd create stor01 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[WARNIN]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("> ceph-volume lvm activate successful "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" osd ID: 1\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[WARNIN]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("> ceph-volume lvm create successful "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" checking OSD status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" find the location of an executable\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("cluster=ceph osd stat "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format=json\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.osd]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Host stor01 is now ready "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" osd use"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看命令执行后的ceph的集群状态\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 59m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 27m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 2 osds: 2 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 98s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 2 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 98s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(":\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n结果显示：\n\t在services部分，的osd多了信息，有两个osd是up的状态"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("而且都加入到了集群中。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("接下来，我们通过批量操作的方式，将其他节点主机的磁盘都格式化\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in 2 3\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  ceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf osd create stor0"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdb\n  ceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf osd create stor0"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\ndone\n\n执行后的效果如下：\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("再次查看集群状态\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 66m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 34m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 5s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 5s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(":\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n结果显示：\n\tosd的磁盘数量达到了 6个，都是处于up的状态。\n\t对于ceph集群的数据容量来说，一共有120G的磁盘空间可以使用\n")])])]),s("p",[t._v("查看节点磁盘状态")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy osd list stor01\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.cli]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Invoked "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin/ceph-deploy osd list stor01\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" connection detected need "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" sudo\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" connected to host: stor01\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" detect platform information "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" remote host\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" detect machine "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" find the location of an executable\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.osd]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Distro info: CentOS Linux 7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2009 Core\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.osd]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" Listing disks on stor01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" find the location of an executable\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[INFO  ]")]),t._v(" Running command: sudo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/sbin/ceph-volume lvm list\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" ====== osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 =======\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),t._v("                      block\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       vdo                       0\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       devices                   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdb\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" ====== osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1 =======\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),t._v("                      block\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       vdo                       0\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[stor01]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v("       devices                   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n")])])]),s("p",[t._v("OSD的磁盘状态查看")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("对于osd来说，它还有一个专门用于osd管理的 命令 ceph，相关的帮助信息如下\nceph osd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help\n帮助解析：\n\t这里面有几个是与osd信息查看相关的\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\t\t       \t查看所有OSD的id值\n\tdump\t     \t查看 OSD 的概述性信息\n\tstatus\t\t\t查看 OSD 的详细的状态信息\n\tstat\t\t\t查看 OSD 的精简的概述性信息\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看所有OSD的id值 \n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n0\n1\n2\n3\n4\n5\n\n查看 OSD 的概述性信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd dump\nepoch 25\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nmax_osd 6\nosd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 up   in  weight 1 up_from 5 up_thru 0 down_at 0 last_clean_interval "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[v2:10.0.0.13:6802/5544,v1:10.0.0.13:6803/5544]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[v2:192.168.8.13:6800/5544,v1:192.168.8.13:6801/5544]")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up 78bd7a7e-9dcf-4d91-be20-d5de2fbec7dd\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n查看 OSD 的精简的概述性信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd stat\n6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 4m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 4m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" epoch: e25\n\n\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-6-osd操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-6-osd操作"}},[t._v("#")]),t._v(" 1.2.6 OSD操作")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 基本实践、进阶实践、小结、三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("基本实践")])]),t._v(" "),s("p",[t._v("简介")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tOSD全称Object Storage Device，负责响应客户端请求返回具体数据的进程。一个Ceph集群中，有专门的osd角色主机，在这个主机中一般有很多个OSD设备。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("对于osd来说，它还有一个专门用于osd管理的 命令 ceph，相关的帮助信息如下\n\tceph osd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("help\n帮助解析：\n\t这里面有几个是与osd信息查看相关的\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\t\t       \t查看所有OSD的id值\n\tdump\t     \t查看 OSD 的概述性信息\n\tstatus\t\t\t查看 OSD 的详细的状态信息\n\tstat\t\t\t查看 OSD 的精简的概述性信息\n\ttree \t\t\t查看 OSD 在主机上的分布信息\n\tperf\t\t\t查看 OSD 磁盘的延迟统计信息\n\tdf\t\t\t\t查看 OSD 磁盘的使用率信息\n")])])]),s("p",[t._v("命令查看")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看所有OSD的id值 \n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n0\n1\n2\n3\n4\n5\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看 OSD 的数据映射信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd dump\nepoch 25\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nmax_osd 6\nosd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 up   in  weight 1 up_from 5 up_thru 0 down_at 0 last_clean_interval "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[v2:10.0.0.13:6802/5544,v1:10.0.0.13:6803/5544]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[v2:192.168.8.13:6800/5544,v1:192.168.8.13:6801/5544]")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up 78bd7a7e-9dcf-4d91-be20-d5de2fbec7dd\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n查看指定OSD节点的信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd dump 3\nepoch 3\nfsid 1d4e5773-619a-479d-861a-66ba451ce945\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nosd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 down out weight 0 up_from 0 up_thru 0 down_at 0 last_clean_interval "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("new 78bd7a7e-9dcf-4d91-be20-d5de2fbec7dd\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看 OSD 的精简的概述性信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd stat\n6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 4m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 4m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" epoch: e25\n状态解析：\n\tOSD节点数量"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("osds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t集群内"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、集群外"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t运行"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("up"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("、不再运行"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("down"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tOSD 的每一次状态变更的历史信息"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("epoch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看 OSD 的详细的状态信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd status\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("  host "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("  used "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" avail "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" wr ops "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" wr "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rd")]),t._v(" ops "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("   state   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 0  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" mon01 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 1027M "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 1  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" mon01 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 1027M "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 2  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" mon02 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 1027M "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 3  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" mon02 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 1027M "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 4  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 1027M "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 5  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 1027M "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" 18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("    0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("     0   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看OSD在各个主机上的分布情况\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11691 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n 1   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("5       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon02\n 2   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n 3   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("3      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("7       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon03\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n 5   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看OSD磁盘的延迟统计信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd perf\nosd commit_latency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" apply_latency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  5                  0                 0\n  4                  0                 0\n  0                  0                 0\n  1                  0                 0\n  2                  0                 0\n  3                  0                 0\n结果显示：\n\t主要解决单块磁盘问题，如果有问题及时剔除OSD。统计的是平均值\n\tcommit_latency 表示从接收请求到设置commit状态的时间间隔\n\tapply_latency 表示从接收请求到设置apply状态的时间间隔\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看OSD磁盘的使用率信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd df\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  REWEIGHT SIZE    RAW USE "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATA")]),t._v("    OMAP META  AVAIL   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("USE "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VAR")]),t._v("  PGS STATUS\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000  20 GiB 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 GiB 3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2 MiB  0 B 1 GiB  19 GiB 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("02 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00   0     up\n 1   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000  20 GiB 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 GiB 3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2 MiB  0 B 1 GiB  19 GiB 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("02 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00   0     up\n 2   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000  20 GiB 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 GiB 3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2 MiB  0 B 1 GiB  19 GiB 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("02 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00   0     up\n 3   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000  20 GiB 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 GiB 3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2 MiB  0 B 1 GiB  19 GiB 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("02 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00   0     up\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000  20 GiB 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 GiB 3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2 MiB  0 B 1 GiB  19 GiB 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("02 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00   0     up\n 5   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000  20 GiB 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 GiB 3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("2 MiB  0 B 1 GiB  19 GiB 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("02 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00   0     up\n                    TOTAL 120 GiB 6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 GiB  20 MiB  0 B 6 GiB 114 GiB 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("02\nMIN/MAX "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VAR")]),t._v(": 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00/1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00  STDDEV: 0\n")])])]),s("p",[s("strong",[t._v("进阶实践")])]),t._v(" "),s("p",[t._v("osd 暂停开启")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\tceph osd pause\t\t集群暂停接收数据\n\tceph osd unpause\t集群开始接收数据\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pause\npauserd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pausewr is "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 2h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 2h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 107m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 107m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n         flags pauserd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pausewr\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以看到，多了pause的标签")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd unpause\npauserd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pausewr is unset\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 2h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 2h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 107m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 107m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\t\t\t\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以看到，pause的标签已经被移除")]),t._v("\n")])])]),s("p",[t._v("osd数据操作比重")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\tosd节点上线：ceph osd crush reweight osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("编号 权重值\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看默认的OSD操作权重值\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11691 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0\n 1   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n修改osd的数据操作权重值\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush reweight osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\nreweighted item id 0 name "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'osd.0'")]),t._v(" to 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1 in crush map\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("19742 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11948     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("09999         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0\n 1   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n恢复osd的数据操作权重值 \n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush reweight osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949\nreweighted item id 0 name "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'osd.0'")]),t._v(" to 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949 in crush map\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11691 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0\n 1   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\n\n")])])]),s("p",[t._v("osd上下线")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\tosd节点上线：ceph osd down osd编号\n\tosd节点下线：ceph osd up osd编号\n注意：\n\t由于OSD有专门的管理服务器控制，一旦发现被下线，会尝试启动它\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("将磁盘快速下线，然后查看状态\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd down 0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ceph osd tree\nmarked down osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11691 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0    down  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n等待一秒钟后查看状态，指定的节点又上线了\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11691 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[t._v("驱逐加入OSD对象")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("命令格式：\n\tceph osd out osd编号\n\tceph osd in osd编号\n注意：\n\t所谓的从OSD集群中驱离或者加入OSD对象，本质上Ceph集群数据操作的权重值调整\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("将0号OSD下线\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd out 0\nmarked out osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11691 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0      up        0 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" \n\n将0号OSD上线\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd in 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmarked in osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("11691 root default\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon01\n 0   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n结果显示：\n\tOSD在上下线实践的时候，所谓的REWEIGHT会进行调整，1代表上线，空代表下线\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-7-osd节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-7-osd节点"}},[t._v("#")]),t._v(" 1.2.7 OSD节点")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 OSD删除、OSD添加、小结 三个方面来学习")]),t._v(" "),s("p",[s("strong",[t._v("OSD删除")])]),t._v(" "),s("p",[t._v("基本步骤")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("将OSD删除需要遵循一定的步骤：\n\t1 修改osd的数据操作权重值，让数据不分布在这个节点上\n\t2 到指定节点上，停止指定的osd进程\n\t3 将移除OSD节点状态标记为out\n\t4 从crush中移除OSD节点，该节点不作为数据的载体\n\t5 删除OSD节点\n\t6 删除OSD节点的认证信息\n")])])]),s("p",[t._v("删除OSD节点实践")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("修改osd的数据操作权重值\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush reweight osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5 0\nreweighted item id 5 name "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'osd.5'")]),t._v(" to 0 in crush map\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("7       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949     host mon03\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4\n 5   hdd       0         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("到指定节点上，停止指定的osd进程\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ssh mon03 sudo systemctl disable ceph-osd@5\nRemoved symlink "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/systemd/system/ceph-osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wants/ceph-osd@5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ssh mon03 sudo systemctl stop ceph-osd@5\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ssh mon03 sudo systemctl status ceph-osd@5\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n9月 25 15:25:32 mon03 systemd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Stopped Ceph object storage daemon osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("将移除OSD节点状态标记为out\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd out osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5\nmarked out osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("7       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949     host mon03\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n 5   hdd       0         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5    down        0 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("从crush中移除OSD节点，该节点不作为数据的载体\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush remove osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5\nremoved item id 5 name "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'osd.5'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" crush map\n\n查看效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd crush tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("7       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949     host mon03\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4\n结果显示：\n\tosd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5 已经被移除了\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("删除OSD节点前查看效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("7       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949     host mon03\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n 5             0 osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5            down        0 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n \n移除无效的osd节点\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5\nremoved osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5\n\n再次确认效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("7       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949     host mon03\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n结果显示：\n\tosd节点已经被移除了\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看历史认证信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph auth "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nosd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5\n        key: AQCy4C9jI1wzDhAAaPjSPSQpMdu8NUPIRecctQ==\n        caps: "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mgr]")]),t._v(" allow profile osd\n        caps: "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon]")]),t._v(" allow profile osd\n        caps: "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[osd]")]),t._v(" allow "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n删除OSD节点的认证信息\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph auth "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),t._v(" osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5\nupdated\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph auth "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n结果显示：\n\t已经没有历史的节点信息了\n")])])]),s("p",[s("strong",[t._v("OSD添加")])]),t._v(" "),s("p",[t._v("基本步骤")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("将OSD增加到集群需要遵循一定的步骤：\n\t1 确定OSD节点没有被占用\n\t2 磁盘格式化\n\t3 ceph擦除磁盘上的数据\n\t4 添加OSD到集群\n")])])]),s("p",[t._v("添加OSD节点实践简介")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("确定OSD节点没有被占用\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# blkid | egrep 'sd[bc]'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdb: UUID="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h3NNr5-Sgr8-nJ8k-QWbY-UiRu-Pbmu-nxs3pZ"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v("="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LVM2_member"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc: UUID="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"VdOW5k-zxMN-4Se5-Bxlc-8h93-uhPA-R30P3u"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v("="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LVM2_member"')]),t._v("\n\n格式化磁盘失败\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkfs.ext4 /dev/sdc")]),t._v("\nmke2fs 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("9 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("28-Dec-2013"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc is entire device"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" not just one partition!\n无论如何也要继续? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" y\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc is apparently in use by the system"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" will not make a 文件系统 here!\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看被占用的磁盘\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dmsetup status")]),t._v("\nceph-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("9dd352be-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1b6e-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("4d60-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("957e-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("81c59eafa7b3-osd-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("block-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("49251ee9-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("b1cc-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("432f-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aed7-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3af897911b60: 0 41934848 linear\nceph-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("3712fe04-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cc04-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("4ce4-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a75e-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f7f746d62d6f-osd-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("block-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("99787a7e-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("40ee-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("48ae-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("802a-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("491c4f326d0c: 0 41934848 linear\n\n1 确定OSD节点没有被占用，注意ceph的osd挂载目录\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /var/lib/ceph/osd/ceph-4/fsid")]),t._v("\n49251ee9-b1cc-432f-aed7-3af897911b60\n\n移除被占用磁盘\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dmsetup remove ceph--3712fe04--cc04--4ce4--a75e--f7f746d62d6f-osd--block--99787a7e--40ee--48ae--802a--491c4f326d0c")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dmsetup status | grep 99787a7e")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("2 磁盘格式化\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[root@mon03 ~]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkfs.ext4 /dev/sdc")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("3 ceph擦除磁盘上的数据\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy disk zap stor03 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("4 添加OSD到集群\nceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf osd create stor03 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev/sdc\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("确认效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd tree\nID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLASS")]),t._v(" WEIGHT  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TYPE")]),t._v(" NAME      STATUS REWEIGHT PRI-AFF\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("7       0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("03897     host mon03\n 4   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n 5   hdd 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("01949         osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5      up  1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("00000\n结果显示：\n\t之前被移除的osd节点已经被找回来了\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-8-存储实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-8-存储实践"}},[t._v("#")]),t._v(" 1.2.8 存储实践")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 基本环境、OSD实践、小结、三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("基本环境")])]),t._v(" "),s("p",[t._v("存储术语")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("Pool\n\tRADOS存储集群提供的基础存储服务需要由“存储池（pool）”分割为逻辑存储 区域，此类的逻辑区域亦是对象数据的名称空间。\n\nPG\n\t归置组（Placement "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Group")]),t._v("）是用于跨OSD将数据存储在某个存储池中的内部数据 结构\n\t相对于存储池来说，PG是一个虚拟组件，它是对象映射到存储池时使用的虚拟层\n\t是实现大容量集群的关键效率技术\n\t\nPGP\t\n\t "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Placement "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Group")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" Placement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("是用于维持PG和OSD的一种策略。\n\t 防止OSD重新分配时候，PG找不到之前的OSD，从而引起大范围的数据迁移\n\t \nCRUSH\n\t把对象直接映射到OSD之上会导致二者之间的紧密耦合关系，在OSD设备变动时不可避免地对整个集群产生扰动。所以需要一种策略算法来处理这种问题。\n\tCeph将一个对象映射进RADOS集群的过程分为两步\n    \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 首先是以一致性哈希算法将对象名称映射到PG \n    \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 而后是将PG ID基于CRUSH算法映射到OSD\n\tCRUSH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Controlled Replication Under Scalable Hashing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("它是一种数据分布式算法，类似于一致性哈希算法，用于为RADOS存储集群控制数据分布。\n")])])]),s("p",[t._v("基本逻辑图")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636103641572-1664092679864.png",alt:"1636103641572"}})]),t._v(" "),s("p",[t._v("需求")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tOSD平台的目的就是数据的存在，我们这里就先来简单的演示一下，OSD环境的数据操作。这里主要临时演示两个功能:\n\t数据存储 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 客户端连接至RADOS集群上某存储池"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("根据相关的CRUSH规则完成数据对象存储"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\t数据删除 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 集合配套的命令，实现数据的移除功能。\n")])])]),s("p",[s("strong",[t._v("OSD实践")])]),t._v(" "),s("p",[t._v("创建存储池")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式\n\tceph osd pool create <pool-name> <pg-num> "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[pgp-num]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[replicated]")]),t._v(" \\ "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[crush-rule-name]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[expected-num-objects]")]),t._v("\n\t参数解析：\n\t\tpool-name：存储池名称，在一个RADOS存储集群上必须具有唯一性；\n\t\tpg-num：当前存储池中的PG数量，一定要合理\n\t\tpgp-num ：用于归置的PG数量，其值应该等于PG的数量\n\t\treplicated：存储池类型；副本存储池需更多原始存储空间，但已实现Ceph支持的所有操 作\n\t\tcrush-ruleset-name：此存储池所用的CRUSH规则集的名称，引用的规则集必须事先存在\n查看命令\n\tceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n\trados lspools\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("创建一个存储池，名称为mypool，pg数量和pgp数量都是16\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool create mypool 16 16\npool "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mypool'")]),t._v(" created\n\n查看存储池的列表\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nmypool\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ rados lspools\nmypool\n")])])]),s("p",[t._v("数据的上传")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\t虽然我们目前没有形成专用的数据接口，但是ceph提供了一个原理的文件测试接口 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" rados命令\n\trados put 文件对象名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path/to/file "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pool=存储池 \n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("提交文件到对应的osd里面\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ rados put ceph-file "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/ceph-cluster/ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pool=mypool\n\n确认上传数据效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ rados "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pool=mypool\nceph-file\n")])])]),s("p",[t._v("查看数据的存储关系")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\t通过属性的方式获取到存储池中数据对象的具体位置信息\n\tceph osd map 存储池 文件对象名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看ceph-file文件对象的内部属性关系\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd map mypool ceph-file\nosdmap e51 pool "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mypool'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" object "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ceph-file'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("> pg 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("7753490d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("> up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" acting "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n结果解析：\n\t可以看到文件对象的内部属性关系\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" num "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 是副本所存储的osd id的值\n")])])]),s("p",[t._v("数据删除实践")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\t将文件对象从pool里面删除\n\trados "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 文件对象名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pool=存储池\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("将刚才添加的文件对象从存储池里面移除\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ rados "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" ceph-file "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pool=mypool\n\n查看存储池的内容\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ rados "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pool=mypool\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-9-存储解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-9-存储解析"}},[t._v("#")]),t._v(" 1.2.9 存储解析")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 存储解析、存储删除、小结、三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("基本环境")])]),t._v(" "),s("p",[t._v("数据存储逻辑")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/1636103641572.png",alt:"1636103641572"}})]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("pool 是ceph存储数据时的逻辑分区，它起到据不同的用户场景，基于namespace实现隔离故障域的作用。\n每个pool包含一定数量的PG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PG里的对象被映射到不同的OSD上。\nOSD分散到所有的主机磁盘上\n")])])]),s("p",[t._v("存储池基本信息")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式\n\tceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[detail]")]),t._v("\n\tceph osd pool stats "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("<poolname>"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看存储池名称\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nmypool\n\n查看存储池详情\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" detail\npool 1 "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mypool'")]),t._v(" replicated size 3 min_size 2 crush_rule 0 object_hash rjenkins pg_num 16 pgp_num 16 autoscale_mode warn last_change 51 flags hashpspool stripe_width 0\n\n确认存储池状态\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool stats mypool\npool mypool id 1\n  nothing is going on\n结果显示：\n\t对于mypool来说，它的id是1，该存储池里面的所有pg都是以1为开头的\n")])])]),s("p",[t._v("存储池&PG")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("通过 pg 查找 pool\n\tceph pg dump "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^{poolid}\\."')]),t._v("\n \n通过 pool 查找 pg\n\tceph pg "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("by-pool "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("poolname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tceph pg "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("poolid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("根据pg查找pools\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph pg dump "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1. "')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph pg dump pools\nPOOLID OBJECTS "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n1            0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n根据存储池找PG\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph pg "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("by-pool mypool "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" awk "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $1,$2,$15}'")]),t._v("\nPG OBJECTS ACTING\n1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("p3\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("e 0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("p2\n1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f 0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("p3\n\n看出mypool的pg都是以1开头的"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("确定pg的分布情况\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph pg dump pgs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("grep ^1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("awk "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $1,$2,$15,$19}'")]),t._v("\ndumped pgs\n1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f 0 0"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0 [3,1,4]\n...\n1.9 0 0'")]),t._v("0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n结果显示：\n\t每个pg都会分布在三个osd上，整个集群有6个osd\n")])])]),s("p",[t._v("PG & OSD")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("通过 pg 查找 osd\n\tceph pg map "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("pgid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n通过 osd 查找 pg\n\tceph pg "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("by-osd osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("osdid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("根据pg找osd的分布\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph pg map 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\nosdmap e51 pg 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("> up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" acting "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n根据osd找pg的分布\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph pg "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("by-osd osd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" awk "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $1,$2,$10,$14,$15}'")]),t._v("\nPG OBJECTS STATE UP ACTING\n1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("3 0 active+clean "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("p1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("p1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f 0 active+clean "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("p3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("p3\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" NOTE: and soon afterwards\n")])])]),s("p",[s("strong",[t._v("存储删除")])]),t._v(" "),s("p",[t._v("存储池删除")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\t删除存储池命令存在数据丢失的风险，Ceph于是默认禁止此类操作。\n\t管理员需要在ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf配置文件中启用支持删除动作\n\tceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 存储池名 存储池名 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("yes-i-really-really-mean-it\n\t注意：\n\t\t存储池名称必须出现两遍，后面的 参数代表是强制\n")])])]),s("p",[t._v("删除实践")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("默认情况下删除存储池\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" mypool mypool "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("yes-i-really-really-mean-it\nError EPERM: pool deletion is disabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" you must first "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" the mon_allow_pool_delete config option to true before you can destroy a pool\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("主节点上修改ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf文件，增加两行配置，让其运行删除pool\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ tail "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n2 ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[mon]")]),t._v("\nmon allow pool delete = true\n\n同步ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf文件到所有的ceph节点上\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("overwrite-conf config push admin mon01 mon02 mon03\n\n重启所有的mon节点上的ceph-mon服务\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i in mon0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" ssh "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sudo systemctl restart ceph-mon.target"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" done\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("将刚才添加的文件对象从存储池里面移除\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" mypool mypool "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("yes-i-really-really-mean-it\npool "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mypool'")]),t._v(" removed\n\n确认效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool stats\nthere are no pools!\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph osd pool "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-10-环境完善"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-10-环境完善"}},[t._v("#")]),t._v(" 1.2.10 环境完善")]),t._v(" "),s("p",[t._v("学习目标")]),t._v(" "),s("p",[t._v("这一节，我们从 扩展mon、扩展mgr、小结、三个方面来学习。")]),t._v(" "),s("p",[s("strong",[t._v("扩展mon")])]),t._v(" "),s("p",[t._v("操作mon节点基础")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("命令格式：\n\tceph-deploy mon add mon节点名称\n\t注意：如果add换成destroy，则变成移除mon节点\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("查看ceph的mon状态\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 3m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 4h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 60m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 60m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph mon stat\ne1: 3 mons at "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("mon01="),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[v2:10.0.0.13:3300/0,v1:10.0.0.13:6789/0]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02="),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[v2:10.0.0.14:3300/0,v1:10.0.0.14:6789/0]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03="),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[v2:10.0.0.15:3300/0,v1:10.0.0.15:6789/0]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" election epoch 6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" leader 0 mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("2 mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03\n")])])]),s("p",[t._v("移除实践")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("移除mon节点\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy mon destroy mon03\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n查看效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 2 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 9s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 4h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 63m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 63m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n结果显示：\n\tmon03已经被移除了\n")])])]),s("p",[t._v("扩展实践")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("扩展mon实践\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy mon add mon03\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n确认效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 2s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 4h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 65m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 65m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n结果显示：\n\tmon03已经被添加到集群了\n")])])]),s("p",[s("strong",[t._v("扩展mgr")])]),t._v(" "),s("p",[t._v("简介")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("\tCeph Manager在高可用的场景下，守护进程以“Active/Standby”模式运行，部署其它ceph-mgr守护程序可确保在Active节点或其上的ceph-mgr守护进程故障时，其中的一个Standby实例可以在不中断服务的情况下接管其任务。如果只有一个mgr服务器的话，守护进程的状态是Active。\n")])])]),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("确认效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 2s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 4h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 65m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 65m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("扩展实践")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("在当前的环境中，添加mgr节点\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph-deploy mgr create mon02\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ceph_deploy.conf]")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[DEBUG ]")]),t._v(" found configuration file at: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home/cephadm/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cephdeploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n查看效果\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[cephadm@admin ceph-cluster]")]),t._v("$ ceph "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n  cluster:\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  services:\n    mon: 3 daemons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quorum mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mon03 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 3m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: mon01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" since 4h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" standbys: mon02\n    osd: 6 osds: 6 up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 69m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 6 in "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 69m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n结果显示：\n\tmon01节点就是我们的主角色节点，mon02是我们的从角色节点。\n")])])]),s("p",[s("strong",[t._v("小结")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);